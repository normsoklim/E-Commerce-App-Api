Cambodia E-commerce Checkout Flow Diagram
=========================================

1. CART PAGE
   │
   ▼
2. CHECKOUT PAGE
   │
   ▼
3. PAYMENT METHOD SELECTION
   ├─ PayPal Option
   │  ├─ Create PayPal Order
   │  ├─ Redirect to PayPal
   │  ├─ User completes payment
   │  ├─ Return to site/Handle webhook
   │  └─ Capture payment
   │
   └─ KHQR Option
      ├─ Generate KHQR Code
      ├─ Display QR Code to user
      ├─ User scans with banking app
      ├─ User completes payment
      └─ Verify payment (webhook/manual)

4. PAYMENT PROCESSING
   ├─ Validate payment data
   ├─ Update order status (pending → confirmed)
   ├─ Update payment status (pending → paid)
   ├─ Create transaction record
   └─ Send notifications

5. ORDER CONFIRMATION
   ├─ Success page
   ├─ Email notification
   ├─ Admin notification
   └─ Order tracking

Detailed PayPal Flow:
====================
Cart → Checkout → Payment Method → PayPal Create Order → PayPal Payment → PayPal Capture → Order Confirmed
     │                              │                     │                │
     │                              │                     └─ Cancelled     └─ Failed
     │                              └─ Error
     └─ Error

Detailed KHQR Flow:
==================
Cart → Checkout → Payment Method → KHQR Generate → Display QR → User pays → Verify Payment → Order Confirmed
     │                              │                │           │           │              │
     │                              │                │           │           └─ Failed      └─ Failed
     │                              │                │           └─ Timeout
     │                              │                └─ Scan failed
     │                              └─ Generation failed
     └─ Error

Webhook Processing:
==================
External Payment Gateway → Webhook Endpoint → Validate Signature → Update Order → Send Notifications
                                                    │                    │
                                                    │                    └─ Success/Failure
                                                    └─ Invalid Signature

Security Checks:
==============
Input Validation → Rate Limiting → Authentication → Authorization → Payment Validation → Process Payment